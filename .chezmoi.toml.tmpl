{{/* feature flag default values */}}
{{- $gnupg := false -}}
{{- $java  := false -}}
{{- $ruby  := true  -}}
{{- $rust  := true  -}}

{{/* preserve feature flag edits */}}
{{- with .features -}}
{{-   if hasKey . "gnupg" -}}
{{-     $gnupg = .gnupg -}}
{{-   end -}}
{{-   if hasKey . "java" -}}
{{-     $java = .java -}}
{{-   end -}}
{{-   if hasKey . "ruby" -}}
{{-     $ruby = .ruby -}}
{{-   end -}}
{{-   if hasKey . "rust" -}}
{{-     $rust = .rust -}}
{{-   end -}}
{{- end -}}

{{/* prompt for email address */}}
{{- $email := "" -}}
{{- if hasKey . "email" -}}
{{-   $email = .email -}}
{{- else if stdinIsATTY -}}
{{-   $email = promptString "email" -}}
{{- end -}}

{{/* prompt for work machine */}}
{{- $work := "" -}}
{{- if hasKey . "work" -}}
{{-   $work = .work -}}
{{- else if stdinIsATTY -}}
{{-   $work = promptBool "work" -}}
{{- end -}}

sourceDir = {{ .chezmoi.sourceDir | quote }}

{{/* age encryption */}}
{{- $age_key_file := joinPath .chezmoi.homeDir ".config/age/me.key.txt" -}}
{{- if stat $age_key_file -}}
encryption = "age"

[age]
identity = {{ $age_key_file | quote }}
recipient = "age1wx4x86nt97ya4tfmfhkpj8urfylwlqg8vjg206wy0w2jn9d57sfsc76efl"

{{ end -}}

[data]
email = {{ $email | quote }}
work = {{ $work }}

  [data.features]
  gnupg = {{ $gnupg }}
  java = {{ $java }}
  ruby = {{ $ruby }}
  rust = {{ $rust }}
