{{- if and .features.ruby (eq .chezmoi.os "darwin") -}}
#!/bin/bash
set -e

. "{{ .chezmoi.sourceDir }}/script-helpers.sh"
require_homebrew

installing_feature "Ruby"

install_packages <<EOF
brew "rbenv"
brew "rbenv-default-gems"
EOF

# Load rbenv in case it's the first time installing
eval "$(rbenv init -)"

latest_ruby_version(){
  rbenv install -l 2>/dev/null | rg '^\d' | tail -1
}

latest_ruby="$(latest_ruby_version)"
info "Installing latest Ruby (version $latest_ruby)..."
if rbenv versions | rg "$latest_ruby" > /dev/null; then
  echo "Already installed"
else
  rbenv install "$latest_ruby"
  rbenv global "$latest_ruby"
fi

# vim: syntax=bash filetype=bash
{{ end -}}
